# 静的サイトジェネレータ

この記事は[進捗 Advent Calendar 2020](https://github.com/t-sin/shinchoku-advent-calendar-2020)の10日目の記事です。

今日は軽くいきます。

## ブログを移行したい

[ブログをやっています](http://octahedron.hatenablog.jp)。はてなブログで2015年から断続的に、主につくったものについての記事を書いています。たまに寝言を書いたりもしています。最初は書くネタもほとんどなかったしものもつくってなかったのですが、時が過ぎるのは早いものですね。そんなブログですが、1年くらい前から静的サイトに移行したいなあと考えています。理由はブラウザで長い文章を書くことやGUI操作で画像をはてなのサービスにアップロードするのがだるくなってきたからです。はてなブログで使えるMarkdownは一般的なMarkdownと比較するとかなり独自の拡張がいろいろ入っており、自分の記事がベンダーロックインされている感じがすごく窮屈でした。デザインももっと自由にいじりたいし、どうせならAsciidocとかで記事を書きたいです。あと、記事データをブログにしか残してなかったりするので記事データを手元に置いて管理したいなあという思いもあります。

## 静的サイトジェネレータを調べる

しかしいざ静的サイトジェネレータを調べてみるといろいろなものがでてきます。多機能そうなものがたくさんあります。ただ、多機能すぎてドキュメントを読み込まないとならなさそうでめんどくさいです。ぼくがやりたいことはせいぜいこれくらいです:

- 「記事」をまとめてリスト化したりタグをつけたりしたい
- ランディングページとか自己紹介ページくらいほしい
- 「記事のまとまり」はジャンル (技術とか日記とか) で分けて複数持てるといい

Common Lispだと[Coleslaw](https://github.com/coleslaw-org/coleslaw)という静的サイトジェネレータがあるようですが、多機能すぎてたりたいことを実現するのが逆にめんどくさそうだなと思いました。汎用的なものじゃなく、ぼくの用途にミニマルにフィットした手軽なものがほしい。

## 静的サイトジェネレータを試作した

そんなことを考えつつ、[2019年の4月14日に技術書典6でLisp本を出しました](https://techbookfest.org/event/tbf06/circle/44710001)。この本はLisp言語族のエッセンスを紹介する本でぼくはCommon Lisp章を担当しましたが、この本のサンプルプログラムをどうしようと悩んでいたのでした。30ページくらいで説明しきる程度には小さく、できればQuicklispなどのエコシステムには言及せず純粋にANSI Common Lispの範囲でできるものを考える必要がありました。当時ふと思ったんですよね、「静的サイトジェネレータ」だとファイルI/Oはするけど複雑な外部の何かについて説明する必要はないし、HTMLもS式で書くとしてしまえばリスト処理の説明の題材としてぴったりなのでは、と。そうしてつくったのがこのリポジトリです。

https://github.com/t-sin/asha

ちなみに技術書典6で出した本の状態は[`techbookfest6`](https://github.com/t-sin/asha/tree/techbookfest6)ブランチになっています (げっタグじゃないのか)。本を読んでいただければわかるのですが (ちなみに本記事執筆時点でも物理本が20冊くらい余っているのでほしい方は連絡いただけると通販いたします)、リストをファイルに書き出して記事を追加した日時とかどんなサイト構成なのかなどサイトの状態をファイルで保持するかんじになっています。

## 実運用はできない

ページのテンプレートもS式で記述するのでまあけっこう使いにくいです。なによりいただけないのはS式でHTMLを書きつつ記事を書くという、つらい感じです。どんな感じなのかお見せしましょう。こうです。

```lisp
(:title "静的サイトジェネレータ"
 :tags ("ソフトウェア" "静的サイトジェネレータ")
 :body ((:p "静的サイト (static site) は、HTMLやCSS、画像といったファイルで構成されたページをHTTPサーバによって単に配信しているウェブサイトのことだ。"
            (:br)
            "ブログやコーポレートサイトなど、コンテンツの更新頻度が高くなく動的なふるまいが必要ないウェブサイトで利用されている。"
            (:br)
            "静的サイトはHTTPサーバとファイルさえあれば配信できるため、言語の実行環境やデータベースソフトウェアを用意する必要のある動的サイトに比べて構築の手間が少ない。"
            (:br))
        (:p "近年の静的サイトは最終的なファイルを生成するフレームワークを利用していることが多い。"
            (:br)
            "フレームワークの定める方法に従って、Markdown等の軽量マークアップ言語を用いてコンテンツを用意し、管理コマンドを用いてページの追加やアップロードするファイルの生成を行う。"
            "このようなフレームワークは、静的サイトジェネレータと呼ばれる")
        (:p "既存の静的サイトジェネレータには、Ruby製の"
            (:a :href "" "Jekyll")
            "やNode.js上で動く"
            (:a :href "" "Hexo")
            "、Go製の"
            (:a :href "" "Hugo")
            "などがある。"
            "また、静的サイトジェネレータの情報を集めたサイト"
            (:a :href "" "StaticGen")
            "では、上の3つ以外の静的サイトジェネレータを見ることができる。")))
```

つらひ…。

## 実運用するには

実運用をしようと思うと、どうしてもMarkdownやAsciidocのパーサが必要になります。Common LispにはいくつかMarkdownをHTMLに変換するライブラリはあったと思いますが、コンバータではなく文書構造がほしいんですよね。CSSを当てたりHTMLの生成前になにかしたりしたくなりそうなので。また、表現能力の高さや構文設計の緻密さからAsciidocを採用したい気持ちがしますがこちらはパーサはおろかコンバータも見つかりませんでした。え…つくるの…そこから…？ となってしまい止まっているのが現状です。どうしたらいいんでしょうね。

## おわりに

というわけでブログ移行まではもうちょっと時間がかかりそうです。ちなみに下のこれは本記事のテーマである静的サイトジェネレータAshaのロゴです。アツい。

![Asha logo](https://raw.githubusercontent.com/t-sin/asha/master/asha.gif)
